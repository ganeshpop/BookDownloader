<!DOCTYPE html>
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.w3.org/2002/06/xhtml2/ http://www.w3.org/MarkUp/SCHEMA/xhtml2.xsd" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<link href="Styles/Style01.css" rel="stylesheet" type="text/css" />
<link href="Styles/Style02.css" rel="stylesheet" type="text/css" />
<link href="Styles/Style00.css" rel="stylesheet" type="text/css" />

<style type="text/css">body{margin:1em;background-color:transparent!important;}#sbo-rt-content *{text-indent:0pt!important;}#sbo-rt-content .bq{margin-right:1em!important;}</style></head>
<body><div id="sbo-rt-content" class="calibre"><div class="tocheadb">
    <h1 class="tochead" id="heading_id_2"><a id="pgfId-1059349"/><a id="pgfId-1042491"/>1 Vert.x, asynchronous programming, and reactive systems</h1>
  </div>

  <p class="co-summary-head"><a id="pgfId-1011800"/>This chapter covers</p>

  <ul class="calibre8">
    <li class="co-summary-bullet"><a class="calibre9" id="pgfId-1011837"/>What Vert.x is</li>

    <li class="co-summary-bullet"><a class="calibre9" id="pgfId-1011851"/>Why distributed systems cannot be avoided</li>

    <li class="co-summary-bullet"><a class="calibre9" id="pgfId-1011861"/>The challenges in programming resource-efficient networked applications</li>

    <li class="co-summary-bullet"><a class="calibre9" id="pgfId-1011871"/>What asynchronous and non-blocking programming is</li>

    <li class="co-summary-bullet"><a class="calibre9" id="pgfId-1011881"/>What a reactive application is, and why asynchronous programming is not enough</li>

    <li class="co-summary-bullet"><a class="calibre9" id="pgfId-1011891"/>Alternatives to Vert.x</li>
  </ul>

  <p class="body"><a id="pgfId-1011901"/>We developers live in an industry of buzzwords, technologies, and practices hype cycles. I have long taught university students the elements of designing, program-ming, integrating, and deploying applications, and I have witnessed first-hand how complicated it can be for newcomers to navigate the wild ocean of current technologies.</p>

  <p class="body"><a id="pgfId-1011941"/><i class="fm-italics">Asynchronous</i> and <i class="fm-italics">reactive</i> are important topics in modern applications, and my goal with this book is to help developers understand the core concepts behind these terms, gain practical experience, and recognize <i class="fm-italics">when</i> there are benefits to these approaches. We will use <i class="fm-italics">Eclipse Vert.x</i>, a toolkit for writing asynchronous applications that has the added benefit of providing solutions for the different definitions of what “reactive” means.</p>

  <p class="body"><a id="pgfId-1011950"/>Ensuring that you understand the concepts is a priority for me in this book. While I want to give you a solid understanding of how to write Vert.x applications, I also want to make sure that you can translate the skills you learn here to other similar and possibly competing technologies, now or five years down the road.</p>

  <h2 class="fm-head" id="heading_id_3"><a id="pgfId-1011956"/>1.1 Being distributed and networked is the norm</h2>

  <p class="body"><a id="pgfId-1011966"/>It was common 20 years ago to deploy business applications that could perform all operations while running isolated on a single machine. Such applications typically exhibited a graphical user interface, and they had local databases or custom file management for storing data. This is, of course, a gross exaggeration, as networking was already in use, and business applications could take advantage of database servers over the network, networked file storage, and various remote code operations.</p>

  <p class="body"><a id="pgfId-1011972"/>Today, an application is more naturally exposed to end users through web and mobile interfaces. This naturally brings the network into play, and hence distributed systems. Also, <i class="fm-italics">service-oriented architectures</i> allow the reuse of some functionality <a id="marker-1011983"/>by issuing requests to other services, possibly controlled by a third-party provider. Examples would be delegating authentication in a consumer application to popular account providers like Google, Facebook, or Twitter, or delegating payment processing to Stripe or PayPal.</p>

  <h2 class="fm-head" id="heading_id_4"><a id="pgfId-1011993"/>1.2 Not living on an isolated island</h2>

  <p class="body"><a id="pgfId-1012013"/>Figure 1.1 is a fictional depiction of what a modern application is: a set of networked services interacting with each other. Here are some of these networked services:</p>

  <ul class="calibre8">
    <li class="fm-list-bullet">
      <p class="list"><a class="calibre9" id="pgfId-1012033"/>A database like PostgreSQL or MongoDB stores data.</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1012047"/>A search engine like Elasticsearch allows finding information that was previously indexed, such as products in a catalog.</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1012057"/>A durable storage service like <i class="fm-italics1">Amazon S3</i> provides persistent and replicated data storage of documents.</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1012076"/>A messaging service can be</p>

      <ul class="calibre10">
        <li class="fm-list-bullet2"><a class="calibre9" id="pgfId-1012086"/>An <i class="fm-italics1">SMTP</i> server to programmatically send emails.</li>

        <li class="fm-list-bullet2"><a class="calibre9" id="pgfId-1012113"/>A bot for interacting with users over messaging platforms, such as Slack, Telegram, or Facebook Messenger.</li>

        <li class="fm-list-bullet2"><a class="calibre9" id="pgfId-1012123"/>An integration messaging protocol for application-to-application integration, like AMQP.</li>
      </ul>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1012133"/>An identity management service like Keycloak provides authentication and role management for user and service interactions.</p>
    </li>

    <li class="fm-list-bullet-last">
      <p class="list"><a class="calibre9" id="pgfId-1012143"/>Monitoring with libraries like Micrometer exposes health statuses, metrics, and logs so that external orchestration tools can maintain proper quality of service, possibly by starting new service instances or killing existing ones when they fail.</p>
    </li>
  </ul>

  <p class="fm-figure"><img alt="" class="calibre11" src="Images/CH01_F01_Ponge.png" width="1033" height="707"/></p>

  <p class="fm-figure-caption"><a id="pgfId-1069699"/>Figure 1.1 A networked application/service</p>

  <p class="body"><a id="pgfId-1012153"/>Later in this book you will see examples of typical services such as API endpoints, stream processors, and edge services.<a href="#pgfId-1012156">1</a> The preceding list is not exhaustive, of course, but the key point is that services rarely live in isolation, as they need to talk to other services over the network to function.</p>

  <h2 class="fm-head" id="heading_id_5"><a id="pgfId-1012172"/>1.3 There is no free lunch on the network</h2>

  <p class="body"><a id="pgfId-1012182"/>The network is exactly where a number of things may go wrong in computing:</p>

  <ul class="calibre8">
    <li class="fm-list-bullet">
      <p class="list"><a class="calibre9" id="pgfId-1012188"/>The bandwidth can fluctuate a lot, so data-intensive interactions between services may suffer. Not all services can enjoy fast bandwidth inside the same data center, and even so, it remains slower than communications between processes on the same machine.</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1012202"/>The latency fluctuates a lot, and because services need to talk to services that talk to additional services to process a given request, all network-induced latency adds to the overall request-processing times.</p>
    </li>

    <li class="fm-list-bullet-last">
      <p class="list"><a class="calibre9" id="pgfId-1012212"/>Availability should not be taken for granted: Networks fail. Routers fail. Proxies fail. Sometimes someone runs into a network cable and disconnects it. When the network fails, a service that sends a request to another service may not be able to determine if it is the other service or the network that is down.</p>
    </li>
  </ul>

  <p class="body"><a id="pgfId-1012222"/>In essence, modern applications are made of distributed and networked services. They are accessed over networks that themselves introduce problems, and each service needs to maintain several incoming and outgoing connections.</p>

  <h2 class="fm-head" id="heading_id_6"><a id="pgfId-1012228"/>1.4 The simplicity of blocking APIs</h2>

  <p class="body"><a id="pgfId-1012257"/><a id="marker-1012239"/><a id="marker-1012241"/>Services need to manage connections to other services and requesters. The traditional and widespread model for managing concurrent network connections is to allocate a thread for each connection. This is the model in many technologies, such as Servlets in Jakarta EE (before additions in version 3), Spring Framework (before additions in version 5), Ruby on Rails, Python Flask, and many more. This model has the advantage of simplicity, <a id="marker-1012246"/>as it is <i class="fm-italics">synchronous</i>.</p>

  <p class="body"><a id="pgfId-1012266"/>Let’s look at an example where a TCP server echoes input text back to the client until it sees a <code class="fm-code-in-text">/quit</code> terminal input (shown in listing 1.3).</p>

  <p class="body"><a id="pgfId-1012297"/>The server can be run using the Gradle <code class="fm-code-in-text">run</code> task from the book’s full example project (<code class="fm-code-in-text">./gradlew run -PmainClass=chapter1.snippets.SynchronousEcho</code> in a terminal). By using the <code class="fm-code-in-text">netcat</code> command-line tool, we can send and receive text.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1012357"/>Listing 1.1 Client-side output of a <code class="fm-code-in-listingcaption">netcat</code> session</p>
  <pre class="programlisting">$ netcat localhost 3000
Hello, Vert.x!           <span class="fm-combinumeral">❶</span>
Hello, Vert.x!           <span class="fm-combinumeral">❷</span>
Great
Great
/quit
/quit
$</pre>

  <p class="fm-code-annotation-mob"><a id="pgfId-1062799"/><span class="fm-combinumeral">❶</span> This line is the user input on the command line.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1062820"/><span class="fm-combinumeral">❷</span> This line is sent by the TCP server.</p>

  <p class="fm-callout"><a id="pgfId-1012512"/><span class="fm-callout-head">Tip</span> You may need to install <code class="fm-code-in-text1">netcat</code> (or <code class="fm-code-in-text1">nc</code>) on your operating system.</p>

  <p class="body"><a id="pgfId-1012521"/>On the server side, we can see the following trace.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1012578"/>Listing 1.2 Server-side trace</p>
  <pre class="programlisting">$ ./gradlew run -PmainClass=chapter1.snippets.SynchronousEcho
(...)
~ Hello, Vert.x!
~ Great
~ /quit</pre>

  <p class="body"><a id="pgfId-1012654"/>The code in the following listing provides the TCP server implementation. It is a classical <a id="marker-1012643"/>use of the <code class="fm-code-in-text">java.io</code> package that provides synchronous I/O APIs.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1012714"/>Listing 1.3 Synchronous echo TCP protocol</p>
  <pre class="programlisting">public class SynchronousEcho {
  public static void main(String[] args) throws Throwable {
    ServerSocket server = new ServerSocket();
    server.bind(new InetSocketAddress(3000));
    while (true) {                              <span class="fm-combinumeral">❶</span>
      Socket socket = server.accept();
      new Thread(clientHandler(socket)).start();
    }
  }

  private static Runnable clientHandler(Socket socket) {
    return () -&gt; {
      try (
        BufferedReader reader = new BufferedReader(
          new InputStreamReader(socket.getInputStream()));
        PrintWriter writer = new PrintWriter(
          new OutputStreamWriter(socket.getOutputStream()))) {
        String line = "";
        while (!"/quit".equals(line)) {
          line = reader.readLine();             <span class="fm-combinumeral">❷</span>
          System.out.println("~ " + line);
          writer.write(line + "\n");            <span class="fm-combinumeral">❸</span>
          writer.flush();
        }
      } catch (IOException e) {
        e.printStackTrace();
      }
    };
  }
}</pre>

  <p class="fm-code-annotation-mob"><a id="pgfId-1062603"/><span class="fm-combinumeral">❶</span> The main application thread plays the role of an accepting thread, as it receives socket objects for all new connections. The operation blocks when no connection is pending. A new thread is allocated for each connection.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1062624"/><span class="fm-combinumeral">❷</span> Reading from a socket may block the thread allocated to the connection, such as when insufficient data is being read.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1062641"/><span class="fm-combinumeral">❸</span> Writing to a socket may also block, such as until the underlying TCP buffer data has been sent over the network.</p>

  <p class="body"><a id="pgfId-1013005"/>The server uses the main thread for accepting connections, and each connection is allocated a new thread for processing I/O. The I/O operations are synchronous, so threads may block on I/O operations. <a id="marker-1013007"/><a id="marker-1013010"/></p>

  <h2 class="fm-head" id="heading_id_7"><a id="pgfId-1013016"/>1.5 Blocking APIs waste resources, increase costs</h2>

  <p class="body"><a id="pgfId-1013049"/><a id="marker-1013027"/><a id="marker-1013029"/>The main problem with the code in listing 1.3 is that it allocates a new thread for each incoming connection, and threads are anything but cheap resources. A thread needs memory, and the more threads you have, the more you put pressure on the operating system kernel scheduler, as it needs to give CPU time to the threads. We could improve the code in listing 1.3 by using a thread pool to reuse threads after a connection has been closed, but we still need <i class="fm-italics">n</i> threads for <i class="fm-italics">n</i> connections at any given point in time.</p>

  <p class="fm-figure"><img alt="" class="calibre11" src="Images/CH01_F02_Ponge.png" width="831" height="550"/></p>

  <p class="fm-figure-caption"><a id="pgfId-1069748"/>Figure 1.2 Threads and blocking I/O operations</p>

  <p class="body"><a id="pgfId-1013115"/>This is illustrated in figure 1.2, where you can see the CPU usage over time of three threads for three concurrent network connections. Input/output operations <a id="marker-1013084"/>such as <code class="fm-code-in-text">readLine</code> and <code class="fm-code-in-text">write</code> may <i class="fm-italics">block</i> the thread, meaning that it is being parked <a id="marker-1013120"/>by the operating system. This happens for two reasons:</p>

  <ul class="calibre8">
    <li class="fm-list-bullet">
      <p class="list"><a class="calibre9" id="pgfId-1013130"/>A read operation may be waiting for data to arrive from the network.</p>
    </li>

    <li class="fm-list-bullet-last">
      <p class="list"><a class="calibre9" id="pgfId-1013144"/>A write operation may have to wait for buffers to be drained if they are full from a previous write operation.</p>
    </li>
  </ul>

  <p class="body"><a id="pgfId-1013154"/>A modern operating system can properly deal with a few thousand concurrent threads. Not every networked service will face loads with so many concurrent requests, but this model quickly shows its limits when we are talking about tens of thousands of concurrent connections.</p>

  <p class="body"><a id="pgfId-1013207"/>It is also important to recall that we often need more threads than incoming network connections. To take a concrete example, suppose that we have an HTTP service that offers the best price for a given product, which it does by requesting prices from four other HTTP services, as illustrated in figure 1.3. This type of service is often <a id="marker-1013186"/>called an <i class="fm-italics">edge service</i> or an <i class="fm-italics">API gateway</i>. Requesting each <a id="marker-1013212"/>service in sequence and then selecting the lowest price would render our service very slow, as each request adds to our own service’s latency. The efficient way is to start four concurrent requests from our service, and then wait and gather their responses. This translates to starting four more threads; if we had 1,000 concurrent network requests, we might be using up to 5,000 threads in the worst naive case, where all requests need to be processed at the same time and we don’t use thread pooling or maintain persistent connections from the edge service to the requested services.</p>

  <p class="fm-figure"><img alt="" class="calibre11" src="Images/CH01_F03_Ponge.png" width="1007" height="561"/></p>

  <p class="fm-figure-caption"><a id="pgfId-1069793"/>Figure 1.3 Request processing in an edge service</p>

  <p class="body"><a id="pgfId-1013222"/>Last, but not least, applications are often deployed to containerized or virtualized environments. This means that applications may not see all the available CPU cores, and their allocated CPU time may be limited. Available memory for processes may also be restricted, so having too many threads also eats into the memory budget. Such applications have to share CPU resources with other applications, so if all applications use blocking I/O APIs, there can quickly be too many threads to manage and schedule, which requires starting more server/container instances as traffic ramps up. This translates directly to increased operating costs. <a id="marker-1013224"/><a id="marker-1013227"/></p>

  <h2 class="fm-head" id="heading_id_8"><a id="pgfId-1013233"/>1.6 Asynchronous programming with non-blocking I/O</h2>

  <p class="body"><a id="pgfId-1013266"/><a id="marker-1013244"/><a id="marker-1013246"/>Instead of waiting for I/O operations to complete, we can shift to <i class="fm-italics">non-blocking</i> I/O. You may have already sampled this with the <code class="fm-code-in-text">select</code> function in C.</p>

  <p class="body"><a id="pgfId-1013275"/>The idea behind non-blocking I/O is to request a (blocking) operation, and move on to doing other tasks until the operation result is ready. For example a non-blocking read may ask for up to 256 bytes over a network socket, and the execution thread does other things (like dealing with another connection) until data has been put into the buffers, ready for consumption in memory. In this model, many concurrent connections can be multiplexed on a single thread, as network latency typically exceeds the CPU time it takes to read incoming bytes.</p>

  <p class="body"><a id="pgfId-1013294"/>Java has long <a id="marker-1013283"/>had the <code class="fm-code-in-text">java.nio</code> (Java NIO) package, which offers non-blocking I/O APIs over files and networks. Going back to our previous example of a TCP service that echoes incoming data, listings 1.4 through 1.7 show a possible implementation with Java non-blocking I/O.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1013354"/>Listing 1.4 Asynchronous variant of the echo service: main loop</p>
  <pre class="programlisting">public class AsynchronousEcho {
  public static void main(String[] args) throws IOException {
    Selector selector = Selector.open();

    ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();
    serverSocketChannel.bind(new InetSocketAddress(3000));
    serverSocketChannel.configureBlocking(false);                     <span class="fm-combinumeral">❶</span>
    serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);   <span class="fm-combinumeral">❷</span>

    while (true) {
      selector.select();                                              <span class="fm-combinumeral">❸</span>
      Iterator&lt;SelectionKey&gt; it = selector.selectedKeys().iterator();
      while (it.hasNext()) {
        SelectionKey key = it.next();
        if (key.isAcceptable()) {                                     <span class="fm-combinumeral">❹</span>
          newConnection(selector, key);
        } else if (key.isReadable()) {                                <span class="fm-combinumeral">❺</span>
          echo(key);
        } else if (key.isWritable()) {                                <span class="fm-combinumeral">❻</span>
          continueEcho(selector, key);
        }
        it.remove();                                                  <span class="fm-combinumeral">❼</span>
      }
    }
  }
  // (...)</pre>

  <p class="fm-code-annotation-mob"><a id="pgfId-1062054"/><span class="fm-combinumeral">❶</span> We need to put the channel into non-blocking mode.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1062075"/><span class="fm-combinumeral">❷</span> The selector will notify of incoming connections.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1062092"/><span class="fm-combinumeral">❸</span> This collects all non-blocking I/O notifications.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1062109"/><span class="fm-combinumeral">❹</span> We have a new connection.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1062126"/><span class="fm-combinumeral">❺</span> A socket has received data.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1062143"/><span class="fm-combinumeral">❻</span> A socket is ready for writing again.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1062160"/><span class="fm-combinumeral">❼</span> Selection keys need to be manually removed, or they will be available again in the next loop iteration.</p>

  <p class="body"><a id="pgfId-1013699"/>Listing 1.4 shows the server socket channel preparation code. It opens the server socket channel and makes it non-blocking, then registers an NIO key selector for processing events. The main loop iterates over the selector keys that have events ready for processing and dispatches them to specialized methods depending on the event type (new connections, data has arrived, or data can be sent again).</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1013756"/>Listing 1.5 Asynchronous variant of the echo service: accepting connections</p>
  <pre class="programlisting">private static class Context {                                    <span class="fm-combinumeral">❶</span>
    private final ByteBuffer nioBuffer = ByteBuffer.allocate(512);
    private String currentLine = "";
    private boolean terminating = false;
  }

  private static final HashMap&lt;SocketChannel, Context&gt; contexts = 
  <span class="fm-code-continuation-arrow">➥</span> new HashMap&lt;&gt;();

  private static void newConnection(Selector selector, SelectionKey key) 
  <span class="fm-code-continuation-arrow">➥</span> throws IOException {
    ServerSocketChannel serverSocketChannel = (ServerSocketChannel) 
    <span class="fm-code-continuation-arrow">➥</span> key.channel();
    SocketChannel socketChannel = serverSocketChannel.accept();
    socketChannel
      .configureBlocking(false)
      .register(selector, SelectionKey.OP_READ);                  <span class="fm-combinumeral">❷</span>
    contexts.put(socketChannel, new Context());                   <span class="fm-combinumeral">❸</span>
  }</pre>

  <p class="fm-code-annotation-mob"><a id="pgfId-1061832"/><span class="fm-combinumeral">❶</span> The Context class keeps state related to the handling of a TCP connection.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1061853"/><span class="fm-combinumeral">❷</span> We set the channel to non-blocking and declare interest in read operations.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1061870"/><span class="fm-combinumeral">❸</span> We keep all connection states in a hash map.</p>

  <p class="body"><a id="pgfId-1013953"/>Listing 1.5 shows how new TCP connections are dealt with. The socket channel that corresponds to the new connection is configured as non-blocking and then is tracked for further reference in a hash map, where it is associated to some <i class="fm-italics">context object</i>. The context <a id="marker-1013964"/>depends on the application and protocol. In our case, we track the current line and whether the connection is closing, and we maintain a connection-specific NIO buffer for reading and writing data.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1014025"/>Listing 1.6 Asynchronous variant of the echo service: echoing data</p>
  <pre class="programlisting">private static final Pattern QUIT = Pattern.compile("(\\r)?(\\n)?/quit$");

  private static void echo(SelectionKey key) throws IOException {
    SocketChannel socketChannel = (SocketChannel) key.channel();
    Context context = contexts.get(socketChannel);
    try {
      socketChannel.read(context.nioBuffer);
      context.nioBuffer.flip();
      context.currentLine = context.currentLine + 
      <span class="fm-code-continuation-arrow">➥</span> Charset.defaultCharset().decode(context.nioBuffer);
      if (QUIT.matcher(context.currentLine).find()) {
        context.terminating = true;                             <span class="fm-combinumeral">❶</span>
      } else if (context.currentLine.length() &gt; 16) {
        context.currentLine = context.currentLine.substring(8);
      }
      context.nioBuffer.flip();                                 <span class="fm-combinumeral">❷</span>
      int count = socketChannel.write(context.nioBuffer);
      if (count &lt; context.nioBuffer.limit()) {                  <span class="fm-combinumeral">❸</span>
        key.cancel();
        socketChannel.register(key.selector(), SelectionKey.OP_WRITE);
      } else {
        context.nioBuffer.clear();
        if (context.terminating) {
          cleanup(socketChannel);
        }
      }
    } catch (IOException err) {
      err.printStackTrace();
      cleanup(socketChannel);
    }
  }</pre>

  <p class="fm-code-annotation-mob"><a id="pgfId-1061592"/><span class="fm-combinumeral">❶</span> If we find a line ending with /quit, we terminate the connection.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1061620"/><span class="fm-combinumeral">❷</span> Java NIO buffers need positional manipulations: the buffer has read data, so to write it back to the client, we need to flip and return to the start position.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1061637"/><span class="fm-combinumeral">❸</span> It may happen that not all data can be written, so we stop looking for read operations and declare interest in a notification indicating when the channel can be written to again.</p>

  <p class="body"><a id="pgfId-1014307"/>Listing 1.6 has the code for the <code class="fm-code-in-text">echo</code> method. The processing <a id="marker-1014318"/>is very simple: we read data from the client socket, and then we attempt to write it back. If the write operation was only partial, we stop further reads, declare interest in knowing when the socket channel is writable again, and then ensure all data is written.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1014379"/>Listing 1.7 Asynchronous variant of the echo service: continuing and closing</p>
  <pre class="programlisting">private static void cleanup(SocketChannel socketChannel) throws IOException {
    socketChannel.close();
    contexts.remove(socketChannel);
  }

  private static void continueEcho(Selector selector, SelectionKey key) 
  <span class="fm-code-continuation-arrow">➥</span> throws IOException {
    SocketChannel socketChannel = (SocketChannel) key.channel();
    Context context = contexts.get(socketChannel);
    try {
      int remainingBytes = context.nioBuffer.limit() - context.nioBuffer.position();
      int count = socketChannel.write(context.nioBuffer);
      if (count == remainingBytes) {                       <span class="fm-combinumeral">❶</span>
        context.nioBuffer.clear();
        key.cancel();
        if (context.terminating) {
          cleanup(socketChannel);
        } else {
          socketChannel.register(selector, SelectionKey.OP_READ);
        }
      }
    } catch (IOException err) {
      err.printStackTrace();
      cleanup(socketChannel);
    }
  }
}</pre>

  <p class="fm-code-annotation-mob"><a id="pgfId-1061515"/><span class="fm-combinumeral">❶</span> We remain in this state until all data has been written back. Then we drop our write interest and declare read interest.</p>

  <p class="body"><a id="pgfId-1014593"/>Finally, listing 1.7 shows the methods for closing the TCP connection and for finishing writing a buffer. When all data has been written in <code class="fm-code-in-text">continueEcho</code>, we register interest <a id="marker-1014604"/>again in reading data.</p>

  <p class="body"><a id="pgfId-1014614"/>As this example shows, using non-blocking I/O is doable, but it significantly increases the code complexity compared to the initial version that used blocking APIs. The echo protocol needs two states for reading and writing back data: reading, or finishing writing. For more elaborate TCP protocols, you can easily anticipate the need for more complicated state machines.</p>

  <p class="body"><a id="pgfId-1014636"/>It is also important to note that like most JDK APIs, <code class="fm-code-in-text">java.nio</code> focuses solely on what it does (here, I/O APIs). It does not provide higher-level protocol-specific helpers, like for writing HTTP clients and servers. Also, <code class="fm-code-in-text">java.nio</code> does not prescribe a threading model, which is still important to properly utilize CPU cores, nor does it handle asynchronous I/O events or articulate the application processing logic.</p>

  <p class="fm-callout"><a id="pgfId-1014655"/><span class="fm-callout-head">Note</span> This is why, in practice, developers rarely deal with Java NIO. Networking libraries like Netty and Apache MINA solve the shortcomings of Java NIO, and many toolkits and frameworks are built on top of them. As you will soon discover, Eclipse Vert.x is one of them. <a id="marker-1014657"/><a id="marker-1014660"/></p>

  <h2 class="fm-head" id="heading_id_9"><a id="pgfId-1014666"/>1.7 Multiplexing event-driven processing: The case of the event loop</h2>

  <p class="body"><a id="pgfId-1014686"/><a id="marker-1014677"/>A popular threading model for processing asynchronous events is that of the event loop. Instead of polling for events that may have arrived, as we did in the previous Java NIO example, events are pushed to an <i class="fm-italics">event loop</i>.</p>

  <p class="body"><a id="pgfId-1014705"/>As you can see in figure 1.4, events are queued as they arrive. They can be I/O events, such as data being ready for consumption or a buffer having been fully written to a socket. They can also be any <i class="fm-italics">other</i> event, such as a timer firing. A single thread is assigned to an event loop, and processing events shouldn’t perform any blocking or long-running operation. Otherwise, the thread blocks, defeating the purpose of using an event loop.</p>

  <p class="fm-figure"><img alt="" class="calibre11" src="Images/CH01_F04_Ponge.png" width="963" height="480"/></p>

  <p class="fm-figure-caption"><a id="pgfId-1069838"/>Figure 1.4 Processing events using an event loop</p>

  <p class="body"><a id="pgfId-1014734"/>Event loops are quite popular: JavaScript code running in web browsers runs on top of an event loop. Many graphical interface toolkits, such as Java Swing, also have an event loop.</p>

  <p class="body"><a id="pgfId-1014740"/>Implementing an event loop is easy.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1014797"/>Listing 1.8 Using a simple event loop</p>
  <pre class="programlisting">public static void main(String[] args) {
  EventLoop eventLoop = new EventLoop();
  new Thread(() -&gt; {                                            <span class="fm-combinumeral">❶</span>
    for (int n = 0; n &lt; 6; n++) {
      delay(1000);
      eventLoop.dispatch(new EventLoop.Event("tick", n));
    }
    eventLoop.dispatch(new EventLoop.Event("stop", null));
  }).start();
  new Thread(() -&gt; {                                            <span class="fm-combinumeral">❷</span>
    delay(2500);
    eventLoop.dispatch(new EventLoop.Event("hello", "beautiful world"));
    delay(800);
    eventLoop.dispatch(new EventLoop.Event("hello", "beautiful universe"));
  }).start();
  eventLoop.dispatch(new EventLoop.Event("hello", "world!"));   <span class="fm-combinumeral">❸</span>
  eventLoop.dispatch(new EventLoop.Event("foo", "bar"));
  eventLoop
    .on("hello", s -&gt; System.out.println("hello " + s))         <span class="fm-combinumeral">❹</span>
    .on("tick", n -&gt; System.out.println("tick #" + n))
    .on("stop", v -&gt; eventLoop.stop())
    .run();
  System.out.println("Bye!");
}

private static void delay(long millis) {                        <span class="fm-combinumeral">❺</span>
  try {
    Thread.sleep(millis);
  } catch (InterruptedException e) {
    throw new RuntimeException(e);
  }
}</pre>

  <p class="fm-code-annotation-mob"><a id="pgfId-1061129"/><span class="fm-combinumeral">❶</span> A first thread that dispatches events every second to the event loop</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1061150"/><span class="fm-combinumeral">❷</span> A second thread that dispatches two events at 2500 ms and 3300 ms</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1061167"/><span class="fm-combinumeral">❸</span> Events dispatched from the main thread</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1061184"/><span class="fm-combinumeral">❹</span> Event handlers defined as Java lambda functions</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1061201"/><span class="fm-combinumeral">❺</span> This method wraps <a id="marker-1061205"/>a possibly checked exception into an unchecked exception to avoid <a id="marker-1061207"/>polluting the main method code with exception-handling logic.</p>

  <p class="body"><a id="pgfId-1015167"/>The code in listing 1.8 shows the use of an event-loop API whose execution gives the following console output.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1015224"/>Listing 1.9 Console output from the event-loop example</p>
  <pre class="programlisting">hello world!
No handler for key foo
tick #0
tick #1
hello beautiful world
tick #2
hello beautiful universe
tick #3
tick #4
tick #5
Bye!</pre>

  <p class="body"><a id="pgfId-1015323"/>More sophisticated event-loop implementations are possible, but the one in the following listing relies on a queue of events and a map of handlers.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1015380"/>Listing 1.10 A simple event-loop implementation</p>
  <pre class="programlisting">public final class EventLoop {
  private final ConcurrentLinkedDeque&lt;Event&gt; events = new ConcurrentLinkedDeque&lt;&gt;();
  private final ConcurrentHashMap&lt;String, Consumer&lt;Object&gt;&gt; handlers = new 
  <span class="fm-code-continuation-arrow">➥</span> ConcurrentHashMap&lt;&gt;();

  public EventLoop on(String key, Consumer&lt;Object&gt; handler) {     <span class="fm-combinumeral">❶</span>
    handlers.put(key, handler);
    return this;
  }

  public void dispatch(Event event) { events.add(event); }        <span class="fm-combinumeral">❷</span>
  public void stop() { Thread.currentThread().interrupt(); }

  public void run() {
    while (!(events.isEmpty() &amp;&amp; Thread.interrupted())) {         <span class="fm-combinumeral">❸</span>
      if (!events.isEmpty()) {
        Event event = events.pop();
        if (handlers.containsKey(event.key)) {
          handlers.get(event.key).accept(event.data);
        } else {
          System.err.println("No handler for key " + event.key);
        }
      }
    }
  }
}</pre>

  <p class="fm-code-annotation-mob"><a id="pgfId-1060954"/><span class="fm-combinumeral">❶</span> Handlers are stored in a map where each key has a handler.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1060975"/><span class="fm-combinumeral">❷</span> Dispatching is pushing events to a queue.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1060992"/><span class="fm-combinumeral">❸</span> The event loop looks for events and finds a handler based on event keys.</p>

  <p class="body"><a id="pgfId-1015659"/>The event loop runs on the thread that <a id="marker-1059274"/>calls the <code class="fm-code-in-text">run</code> method, and events can be safely <a id="marker-1059276"/>sent from other threads using the <code class="fm-code-in-text">dispatch</code> method.</p>

  <p class="body"><a id="pgfId-1015681"/>Last, but not least, an event is simply a pair of a key and data, as shown in the following, which is a static inner class <a id="marker-1015670"/>of <code class="fm-code-in-text">EventLoop</code>. <a id="marker-1015686"/></p>

  <p class="fm-code-listing-caption"><a id="pgfId-1015744"/>Listing 1.11 A simple event-loop implementation</p>
  <pre class="programlisting">public static final class Event {
  private final String key;
  private final Object data;

  public Event(String key, Object data) {
    this.key = key;
    this.data = data;
  }
}</pre>

  <h2 class="fm-head" id="heading_id_10"><a id="pgfId-1015830"/>1.8 What is a reactive system?</h2>

  <p class="body"><a id="pgfId-1015840"/><a id="marker-1015841"/>So far we have discussed how to do the following:</p>

  <ul class="calibre8">
    <li class="fm-list-bullet">
      <p class="list"><a class="calibre9" id="pgfId-1015849"/>Leverage asynchronous programming and non-blocking I/O to handle more concurrent connections and use less threads</p>
    </li>

    <li class="fm-list-bullet-last">
      <p class="list"><a class="calibre9" id="pgfId-1015863"/>Use one threading model for asynchronous event processing (the event loop)</p>
    </li>
  </ul>

  <p class="body"><a id="pgfId-1015873"/>By combining these two techniques, we can build scalable and resource-efficient applications. Let’s now discuss what a <i class="fm-italics">reactive system</i> is and how it goes beyond “just” asynchronous programming.</p>

  <p class="body"><a id="pgfId-1015934"/>The four properties of reactive systems are exposed in <i class="fm-italics">The Reactive Manifesto</i>: <i class="fm-italics">responsive</i>, <i class="fm-italics">resilient</i>, <i class="fm-italics">elastic</i>, and <i class="fm-italics">message-driven</i> (<span class="fm-hyperlink"><a href="http://www.reactivemanifesto.org/">www.reactivemanifesto.org/</a></span>). We are not going to paraphrase the manifesto in this book, so here is a brief take on what these properties are about:</p>

  <ul class="calibre8">
    <li class="fm-list-bullet">
      <p class="list"><a class="calibre9" id="pgfId-1015977"/><i class="fm-italics1">Elastic</i> --Elasticity <a class="calibre9" id="marker-1015960"/>is the ability for the application to work with a variable number of instances. This is useful, as elasticity allows the app to respond to traffic spikes by starting new instances and load-balancing traffic across instances. This has an interesting impact on the code design, as shared state across instances needs to be well identified and limited (e.g., server-side web sessions). It is useful for instances <a class="calibre9" id="marker-1015966"/>to report <i class="fm-italics1">metrics</i>, so that an orchestrator can decide when to start or stop instances based on both network traffic and reported metrics.</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1016010"/><i class="fm-italics1">Resilient</i> --Resiliency <a class="calibre9" id="marker-1015999"/>is partially the flip side of elasticity. When one instance crashes in a group of elastic instances, resiliency is naturally achieved by redirecting traffic to other instances, and a new instance can be started if necessary. That being said, there is more to resiliency. When an instance cannot fulfill a request due to some conditions, it still tries to answer in <i class="fm-italics1">degraded mode</i>. Depending on <a class="calibre9" id="marker-1016015"/>the application domain, it may be possible to respond with older cached values, or even to respond with empty or default data. It may also be possible to forward a request to some other, non-error instance. In the worst case, an instance can respond with an error, but in a timely fashion.</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1016025"/><i class="fm-italics1">Responsive</i> --Responsivity <a class="calibre9" id="marker-1016038"/>is the result of combining elasticity and resiliency. Consistent response times provide strong service-level agreement guarantees. This is achieved both thanks to the ability to start new instances if need be (to keep response times acceptable), and also because instances still respond quickly when errors arise. It is important to note that responsivity is not possible if one component relies on a non-scalable resource, like a single central database. Indeed, starting more instances does not solve the problem if they all issue requests to one resource that is quickly going to be overloaded.</p>
    </li>

    <li class="fm-list-bullet-last">
      <p class="list"><a class="calibre9" id="pgfId-1016066"/><i class="fm-italics1">Message-driven</i> --Using asynchronous message passing rather than blocking paradigms like remote procedure calls is the key enabler of elasticity and resiliency, which lead to responsiveness. This also enables messages to be dispatched to more instances (making the system elastic) and controls the flow between message producers and message consumers (this is <i class="fm-italics1">back-pressure</i>, and we will <a class="calibre9" id="marker-1060102"/>explore it later in this book).</p>
    </li>
  </ul>

  <p class="body"><a id="pgfId-1016110"/>A reactive system <a id="marker-1016083"/>exhibits these four properties, which make <a id="marker-1016089"/>for <i class="fm-italics">dependable</i> and <i class="fm-italics">resource-efficient</i> systems.</p>

  <div class="fm-sidebar-block">
    <p class="fm-sidebar-title"><a class="calibre9" id="pgfId-1069664"/>Does asynchronous imply reactive?</p>

    <p class="fm-sidebar-text"><a id="pgfId-1069665"/>This is an important question, as being asynchronous is often presented as being a magic cure for software woes. Clearly, reactive implies asynchronous, but the converse is not necessarily true.</p>

    <p class="fm-sidebar-text"><a id="pgfId-1069666"/>As a (not so) fictitious example, consider a shopping web application where users can put items in a shopping cart. This is classically done by storing items in a server-side web session. When sessions are being stored in memory or in local files, the system is not reactive, even if it internally uses non-blocking I/O and asynchronous programming. Indeed, an instance of the application cannot take over another one because sessions are application state, and in this case that state is not being replicated and shared across nodes.</p>

    <p class="fm-sidebar-text"><a id="pgfId-1069667"/>A reactive variant of this example would use a memory grid service (e.g., Hazelcast, Redis, or Infinispan) to store the web sessions, so that incoming requests could be routed to any instance. <a id="marker-1069668"/></p>
  </div>

  <h2 class="fm-head" id="heading_id_11"><a id="pgfId-1016150"/>1.9 What else does reactive mean?</h2>

  <p class="body"><a id="pgfId-1016176"/>As <i class="fm-italics">reactive</i> is a trendy term, it is also being used for very different purposes. You just saw what a <i class="fm-italics">reactive system</i> is, but there are two other popular reactive definitions, summarized in table 1.1.</p>

  <p class="fm-table-caption"><a id="pgfId-1057318"/>Table 1.1 All the reactive things</p>

  <table border="1" class="contenttable" width="100%">
    <colgroup class="calibre3">
      <col class="calibre4" span="1" width="15%"/>
      <col class="calibre4" span="1" width="85%"/>
    </colgroup>

    <tr class="calibre5">
      <th class="fm-contenttable1" colspan="1" rowspan="1">
        <p class="fm-table-head"><a id="pgfId-1057322"/>Reactive?</p>
      </th>

      <th class="fm-contenttable1" colspan="1" rowspan="1">
        <p class="fm-table-head"><a id="pgfId-1057324"/>Description</p>
      </th>
    </tr>

    <tr class="calibre5">
      <td class="fm-contenttable2" colspan="1" rowspan="1">
        <p class="fm-table-body"><a id="pgfId-1057326"/>Systems</p>
      </td>

      <td class="fm-contenttable2" colspan="1" rowspan="1">
        <p class="fm-table-body"><a id="pgfId-1057328"/>Dependable applications that are message-driven, resilient, elastic, and responsive.</p>
      </td>
    </tr>

    <tr class="calibre5">
      <td class="fm-contenttable2" colspan="1" rowspan="1">
        <p class="fm-table-body"><a id="pgfId-1057330"/>Programming</p>
      </td>

      <td class="fm-contenttable2" colspan="1" rowspan="1">
        <p class="fm-table-body"><a id="pgfId-1057332"/>A means of reacting to changes and events. Spreadsheet programs are a great example of reactive programming: when cell data changes, cells having formulas depending on affected cells are recomputed automatically. Later in this book you will see RxJava, a popular reactive extensions API for Java that greatly helps coordinate <a id="marker-1057337"/>asynchronous event and data processing. There is also functional reactive programming, a style of programming that we won’t cover in this book but for which Functional Reactive Programming by Stephen Blackheath and Anthony Jones (Manning, 2016) is a fantastic resource.</p>
      </td>
    </tr>

    <tr class="calibre5">
      <td class="fm-contenttable2" colspan="1" rowspan="1">
        <p class="fm-table-body"><a id="pgfId-1057334"/>Streams</p>
      </td>

      <td class="fm-contenttable2" colspan="1" rowspan="1">
        <p class="fm-table-body"><a id="pgfId-1057336"/>When systems exchange continuous streams of data, the classical producer/consumer problems arise. It is especially important to provide back-pressure mechanisms so <a id="marker-1057338"/>that a consumer can notify a producer when it is emitting too fast. With reactive streams (<span class="fm-hyperlink"><a href="http://www.reactive-streams.org">www.reactive-streams.org</a></span>), the main goal is to reach the best throughput between systems.</p>
      </td>
    </tr>
  </table>

  <h2 class="fm-head" id="heading_id_12"><a id="pgfId-1016368"/>1.10 What is Vert.x?</h2>

  <p class="body"><a id="pgfId-1016378"/><a id="marker-1016379"/>According to the Vert.x website (<span class="fm-hyperlink"><a href="https://vertx.io/">https://vertx.io/</a>), “Eclipse Vert.x is a tool-kit for building reactive applications on the JVM.”</span></p>

  <p class="body"><a id="pgfId-1016388"/>Initiated by Tim Fox in 2012, Vert.x is a project now fostered at the vendor-neutral Eclipse Foundation. While the first project iterations were aimed at being a “Node.js for the JVM,” Vert.x has since significantly deviated toward providing an asynchronous programming foundation tailored for the specifics of the JVM.</p>

  <div class="fm-sidebar-block">
    <p class="fm-sidebar-title"><a class="calibre9" id="pgfId-1069636"/>The essence of Vert.x</p>

    <p class="fm-sidebar-text"><a id="pgfId-1069637"/>As you may have guessed from the previous sections of this chapter, the focus of Vert.x is processing asynchronous events, mostly coming from non-blocking I/O, and the threading model processes events in an event loop.</p>
  </div>

  <p class="body"><a id="pgfId-1016426"/>It is very important to understand that Vert.x is a <i class="fm-italics">toolkit</i> and not a <i class="fm-italics">framework</i>: it does not provide a predefined foundation for your application, so you are free to use Vert.x as a library inside a larger code base. Vert.x is largely unopinionated on the build tools that you should be using, how you want to structure your code, how you intend to package and deploy it, and so on. A Vert.x application is an assembly of modules providing exactly what you need, and nothing more. If you don’t need to access a database, then your project does not need to depend on database-related APIs.</p>

  <p class="body"><a id="pgfId-1016445"/>The Vert.x project is organized in composable modules, with figure 1.5 showing the structure of a random Vert.x application:</p>

  <ul class="calibre8">
    <li class="fm-list-bullet">
      <p class="list"><a class="calibre9" id="pgfId-1016486"/>A core project<a class="calibre9" id="marker-1016475"/>, called <code class="fm-code-in-text">vertx-core</code>, provides the APIs for asynchronous programming, non-blocking I/O, streaming, and convenient access to networked protocols such as TCP, UDP, DNS, HTTP, or WebSockets.</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1016548"/>A set of modules that <a class="calibre9" id="marker-1016501"/>are part of the community-supported Vert.x stack, such as <a class="calibre9" id="marker-1016507"/>a better web API (<code class="fm-code-in-text">vertx-web</code>) or data clients (<code class="fm-code-in-text">vertx-kafka-client</code>, <code class="fm-code-in-text">vertx-redis</code>, <code class="fm-code-in-text">vertx-mongo</code>, etc.) provide functionality <a class="calibre9" id="marker-1016553"/>for building all kinds of applications.</p>
    </li>

    <li class="fm-list-bullet-last">
      <p class="list"><a class="calibre9" id="pgfId-1016563"/>A wider ecosystem of projects provides even more functionality, such as connecting with Apache Cassandra, non-blocking I/O to communicate between system processes, and so on.</p>
    </li>
  </ul>

  <p class="fm-figure"><img alt="" class="calibre11" src="Images/CH01_F05_Ponge.png" width="950" height="440"/></p>

  <p class="fm-figure-caption"><a id="pgfId-1069884"/>Figure 1.5 Overview of the structure of a Vert.x application</p>

  <p class="body"><a id="pgfId-1016573"/>Vert.x is <i class="fm-italics">polyglot</i> as it supports most of the popular JVM languages: JavaScript, Ruby, Kotlin, Scala, Groovy, and more. Interestingly, these languages are not just supported through their interoperability with Java. Idiomatic bindings are being generated, so you can write Vert.x code that still feels natural in these languages. For example, the Scala bindings use the Scala future APIs, and the Kotlin bindings leverage custom DSLs and functions with named parameters to simplify some code constructs. And, of course, you can mix and match different supported languages within the same Vert.x application. <a id="marker-1059534"/></p>

  <h2 class="fm-head" id="heading_id_13"><a id="pgfId-1016591"/>1.11 Your first Vert.x application</h2>

  <p class="body"><a id="pgfId-1016608"/><a id="marker-1016602"/><a id="marker-1016604"/>It’s finally time for us to write a Vert.x application!</p>

  <p class="body"><a id="pgfId-1016613"/>Let’s continue with the echo TCP protocol that we have used in various forms in this chapter. It will still expose a TCP server on port 3000, where any data is sent back to the client. We will add two other features:</p>

  <ul class="calibre8">
    <li class="fm-list-bullet">
      <p class="list"><a class="calibre9" id="pgfId-1016619"/>The number of open connections will be displayed every five seconds.</p>
    </li>

    <li class="fm-list-bullet-last">
      <p class="list"><a class="calibre9" id="pgfId-1016633"/>An HTTP server on port 8080 will respond with a string giving the current number of open connections.</p>
    </li>
  </ul>

  <h3 class="fm-head1" id="heading_id_14"><a id="pgfId-1016643"/>1.11.1 Preparing the project</h3>

  <p class="body"><a id="pgfId-1016662"/><a id="marker-1016654"/><a id="marker-1016656"/><a id="marker-1016658"/>While not strictly necessary for this example, it is easier to use a build tool. In this book, I will show examples with Gradle, but you can find the equivalent Maven build descriptors in the book’s source code Git repository.</p>

  <p class="body"><a id="pgfId-1016695"/>For this project, the only third-party dependency that we need is the <code class="fm-code-in-text">vertx-core</code> artifact plus its <a id="marker-1016678"/>dependencies. This artifact is <a id="marker-1016684"/>on Maven Central under the <code class="fm-code-in-text">io.vertx</code> group identifier.</p>

  <p class="body"><a id="pgfId-1016704"/>An integrated development environment <a id="marker-1016706"/><a id="marker-1016709"/>(IDE) like IntelliJ IDEA Community Edition is great, and it knows how to create Maven and Gradle projects. You can equally use Eclipse, NetBeans, or even Visual Studio Code.</p>

  <p class="fm-callout"><a id="pgfId-1016728"/><span class="fm-callout-head">Tip</span> <a href="https://start.vertx.io">You can also use the Vert.x starter web application at</a> <span class="fm-hyperlink">https://start.vertx .io</span> and generate a project skeleton to download.</p>

  <p class="body"><a id="pgfId-1016735"/>For this chapter let’s use Gradle. A suitable build.gradle.kts file would look like the next listing.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1016792"/>Listing 1.12 Gradle configuration to build and run <code class="fm-code-in-listingcaption">VertxEcho</code></p>
  <pre class="programlisting">plugins {
  java
  application
}

repositories {
  mavenCentral()
}

dependencies {
  implementation("io.vertx:vertx-core:VERSION")    <span class="fm-combinumeral">❶</span>
}

java {
  sourceCompatibility = JavaVersion.VERSION_1_8
}

application {
  mainClassName = "chapter1.firstapp.VertxEcho"    <span class="fm-combinumeral">❷</span>
}</pre>

  <p class="fm-code-annotation-mob"><a id="pgfId-1060841"/><span class="fm-combinumeral">❶</span> Replace VERSION with a release version of Vert.x like 3.9.<span class="fm-hyperlink">1</span> or 4.0.0.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1060869"/><span class="fm-combinumeral">❷</span> This is the fully qualified name of the class containing a main method so that we can use the run Gradle task.</p>

  <p class="fm-callout"><a id="pgfId-1017007"/><span class="fm-callout-head">Tip</span> You may be more familiar with Apache Maven than Gradle. This book uses Gradle because it is a modern, efficient, and flexible build tool. It also uses a concise domain-specific language for writing build files, which works better than Maven XML files in the context of a book. You will find Maven build descriptors equivalent to those of Gradle in the source code Git repository. <a id="marker-1057087"/><a id="marker-1057088"/><a id="marker-1057089"/></p>

  <h3 class="fm-head1" id="heading_id_15"><a id="pgfId-1017020"/>1.11.2 The VertxEcho class</h3>

  <p class="body"><a id="pgfId-1017045"/><a id="marker-1017031"/><a id="marker-1017033"/><a id="marker-1017035"/>The <code class="fm-code-in-text">VertxEcho</code> class implementation is shown in listing 1.15. You can run the application with Gradle using the <code class="fm-code-in-text">run</code> task (<code class="fm-code-in-text">gradle run</code> or <code class="fm-code-in-text">./gradlew run</code>), as follows.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1017140"/>Listing 1.13 Running <code class="fm-code-in-listingcaption">VertxEcho</code></p>
  <pre class="programlisting">$ ./gradlew run

&gt; Task :run
We now have 0 connections
We now have 0 connections
We now have 0 connections
We now have 1 connections
We now have 1 connections
Jul 07, 2018 11:44:14 PM io.vertx.core.net.impl.ConnectionBase
SEVERE: Connection reset by peer
We now have 0 connections
&lt;=========----&gt; 75% EXECUTING [34s]
&gt; :run</pre>

  <p class="fm-callout"><a id="pgfId-1017294"/><span class="fm-callout-head">Tip</span> If you prefer Maven, run <code class="fm-code-in-text1">mvn compile exec:java</code> instead of <code class="fm-code-in-text1">./gradlew run</code> from the chapter1 folder in the book’s source code Git repository.</p>

  <p class="body"><a id="pgfId-1017316"/>You can, of course, interact with the service <a id="marker-1017305"/>with the <code class="fm-code-in-text">netcat</code> command to echo text, and you can make an HTTP request to see the number of open connections, as shown in the following listing.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1017376"/>Listing 1.14 Interacting with <code class="fm-code-in-listingcaption">VertxEcho</code> over TCP and HTTP</p>
  <pre class="programlisting">$ netcat localhost 3000
Hello from Tassin-La-Demi-Lune, France
Hello from Tassin-La-Demi-Lune, France

$ http :8080
HTTP/1.1 200 OK
content-length: 25

We now have 0 connections</pre>

  <p class="fm-callout"><a id="pgfId-1017507"/><span class="fm-callout-head">Tip</span> The <code class="fm-code-in-text1">http</code> command comes from <a id="marker-1017495"/>the HTTPie project at <span class="fm-hyperlink"><a href="https://httpie.org">https:// httpie.org</a></span>. This tool is a developer-friendly alternative to <code class="fm-code-in-text1">curl</code>, and you can easily install it on your operating system.</p>

  <p class="body"><a id="pgfId-1017516"/>Let’s now see the code of <code class="fm-code-in-text">VertxEcho</code>.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1017582"/>Listing 1.15 Implementation of the <code class="fm-code-in-listingcaption">VertxEcho</code> class</p>
  <pre class="programlisting">package chapter1.firstapp;

import io.vertx.core.Vertx;
import io.vertx.core.net.NetSocket;

public class VertxEcho {

  private static int numberOfConnections = 0;                        <span class="fm-combinumeral">❶</span>

  public static void main(String[] args) {
    Vertx vertx = Vertx.vertx();

    vertx.createNetServer()
      .connectHandler(VertxEcho::handleNewClient)                    <span class="fm-combinumeral">❷</span>
      .listen(3000);

    vertx.setPeriodic(5000, id -&gt; System.out.println(howMany()));    <span class="fm-combinumeral">❸</span>

    vertx.createHttpServer()
      .requestHandler(request -&gt; request.response().end(howMany()))  <span class="fm-combinumeral">❹</span>
      .listen(8080);
  }

  private static void handleNewClient(NetSocket socket) {
    numberOfConnections++;
    socket.handler(buffer -&gt; {                                       <span class="fm-combinumeral">❺</span>
      socket.write(buffer);
      if (buffer.toString().endsWith("/quit\n")) {
        socket.close();
      }
    });
    socket.closeHandler(v -&gt; numberOfConnections--);                 <span class="fm-combinumeral">❻</span>
  }

  private static String howMany() {
    return "We now have " + numberOfConnections + " connections";
  }
}</pre>

  <p class="fm-code-annotation-mob"><a id="pgfId-1060436"/><span class="fm-combinumeral">❶</span> As you will see in the next chapter, event handlers are always executed on the same thread, so there is no need for JVM locks or using AtomicInteger.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1060457"/><span class="fm-combinumeral">❷</span> Creating a TCP server requires passing a callback for each new connection.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1060474"/><span class="fm-combinumeral">❸</span> This defines a periodic task with a callback being executed every five seconds.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1060503"/><span class="fm-combinumeral">❹</span> Similar to a TCP server, an HTTP server is configured by giving the callback to be executed for each HTTP request.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1060520"/><span class="fm-combinumeral">❺</span> The buffer handler is invoked every time a buffer is ready for consumption. Here we just write it back, and we use a convenient string conversion helper to look for a terminal command.</p>

  <p class="fm-code-annotation-mob"><a id="pgfId-1060537"/><span class="fm-combinumeral">❻</span> Another event is when the connection closes. We decrement a connections counter that was incremented upon connection.</p>

  <p class="body"><a id="pgfId-1018005"/>This example is interesting in that it has few lines of code. It is centered around a plain old Java <code class="fm-code-in-text">main</code> method, because there is no framework to bootstrap. All we need to create <a id="marker-1060431"/>is a <code class="fm-code-in-text">Vertx</code> context, which in turns offers methods to create tasks, servers, clients, and more, as you will discover in the next chapters.</p>

  <p class="body"><a id="pgfId-1018014"/>While it’s not apparent here, an event loop is managing the processing of events, be it a new TCP connection, the arrival of a buffer, a new HTTP request, or a periodic task that is being fired. Also, every event handler is being executed on the same (event-loop) thread. <a id="marker-1018016"/><a id="marker-1018019"/><a id="marker-1018021"/></p>

  <h3 class="fm-head1" id="heading_id_16"><a id="pgfId-1018027"/>1.11.3 The role of callbacks</h3>

  <p class="body"><a id="pgfId-1018052"/><a id="marker-1018038"/><a id="marker-1018040"/><a id="marker-1018042"/>As you just saw in listing 1.15, <i class="fm-italics">callbacks</i> are the primary method Vert.x uses to notify the application code of asynchronous events and pass them to some handlers. Combined with lambda expressions in Java, callbacks make for a concise way to define event handling.</p>

  <p class="body"><a id="pgfId-1018061"/>You may have heard or experienced the infamous <i class="fm-italics">callback hell</i> where callbacks <a id="marker-1018072"/>get nested into callbacks, leading to code that is difficult to read and reason about.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1018133"/>Listing 1.16 Callback hell illustrated</p>
  <pre class="programlisting">dothis(a -&gt; {
  dothat(b -&gt; {
    andthis(c -&gt; {
      andthat(d -&gt; {
        alsothis(e -&gt; {
          alsothat(f -&gt; {
            // ...
          });
        });
      });
    });
  });
});</pre>

  <p class="body"><a id="pgfId-1018244"/>Be reassured: although the Vert.x core APIs indeed use callbacks, Vert.x provides support for more programming models. Callbacks are the canonical means for notification in event-driven APIs, but as you will see in upcoming chapters, it is possible to build other abstractions on top of callbacks, such as futures and promises, reactive extensions, and coroutines.</p>

  <p class="body"><a id="pgfId-1018250"/>While callbacks have their issues, there are many cases with minimal levels of nesting where they remain a very good programming model with minimal dispatch overhead. <a id="marker-1018252"/><a id="marker-1018255"/><a id="marker-1018257"/></p>

  <h3 class="fm-head1" id="heading_id_17"><a id="pgfId-1018263"/>1.11.4 So is this a reactive application?</h3>

  <p class="body"><a id="pgfId-1018280"/><a id="marker-1018274"/><a id="marker-1018276"/>This is a very good question to ask. It is important to remember that while Vert.x is a toolkit for building reactive applications, using the Vert.x API and modules does not “auto-magically” make an application a reactive one. Yet the event-driven, non-blocking APIs that Vert.x provides tick the first box.</p>

  <p class="body"><a id="pgfId-1018298"/>The short answer is that no, this application is not reactive. Resiliency is not the issue, as the only errors that can arise are I/O related--and they simply result in discarding the connections. The application is also responsive, as it does not perform any complicated processing. If we benchmarked the TCP and HTTP servers, we would get very good latencies with low deviation and very few outliers. The following listing shows an imperfect, yet telling, quick benchmark <a id="marker-1018287"/>with <code class="fm-code-in-text">wrk</code> (<span class="fm-hyperlink"><a href="https://github.com/wg/wrk">https://github.com/ wg/wrk</a></span>) running from a terminal.</p>

  <p class="fm-code-listing-caption"><a id="pgfId-1020093"/>Listing 1.17 Output of a benchmark session with <code class="fm-code-in-listingcaption">wrk</code></p>
  <pre class="programlisting">$ wrk --latency http://localhost:8080/
Running 10s test @ http://localhost:8080/
  2 threads and 10 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   136.98us  106.91us   7.26ms   97.37%
    Req/Sec    36.62k     4.09k   45.31k    85.64%
  Latency Distribution
     50%  125.00us
     75%  149.00us
     90%  199.00us
     99%  340.00us
  735547 requests in 10.10s, 44.89MB read
Requests/sec:  72830.90
Transfer/sec:      4.45MB</pre>

  <p class="body"><a id="pgfId-1020210"/>The culprit for not being reactive clearly is elasticity. Indeed, if we create new instances, each instance maintains its own connection counter. The counter scope is the application, so it should be a shared global counter between all instances.</p>

  <p class="body"><a id="pgfId-1020232"/>As this example shows, designing reactive applications is more subtle than just implementing responsive and resource-efficient systems. Ensuring that an application can run as many replaceable instances is surprisingly more engaging, especially as we need to think about <i class="fm-italics">instance state</i> versus <i class="fm-italics">application state</i> to make sure <a id="marker-1020237"/>that instances <a id="marker-1020243"/>are interchangeable.</p>

  <div class="fm-sidebar-block">
    <p class="fm-sidebar-title"><a class="calibre9" id="pgfId-1069263"/>What if I am a Windows user?</p>

    <p class="fm-sidebar-text"><a id="pgfId-1069265"/><code class="fm-code-in-text1">wrk</code> is a command-line tool that works <a id="marker-1069264"/>on Unix systems like Linux and macOS.</p>

    <p class="fm-sidebar-text"><a id="pgfId-1069266"/>In this book we prefer Unix-style tooling and command-line interfaces over graphical user interfaces. We will use Unix tools that are powerful, intuitive, and maintained by active open source communities.</p>

    <p class="fm-sidebar-text"><a id="pgfId-1069267"/>Fortunately, you don’t have to leave Windows to benefit from these tools! While some of these tools work natively on Windows, starting from Windows 10 you can install the Windows Subsystem for Linux (WSL<a id="marker-1069268"/><a id="marker-1069269"/>) and benefit from a genuine Linux environment alongside your more traditional Windows desktop environment. Microsoft markets WSL as a major feature for developers on Windows, and I can only recommend that you invest some time and get familiar with it. You can see Microsoft’s WSL FAQ for more details: <span class="fm-hyperlink"><a href="https://docs.microsoft.com/en-us/windows/wsl/faq">https://docs.microsoft.com/en-us/windows/wsl/faq</a></span>. <a id="marker-1069271"/><a id="marker-1069272"/><a id="marker-1069273"/><a id="marker-1069274"/></p>
  </div>

  <h2 class="fm-head" id="heading_id_18"><a id="pgfId-1021610"/>1.12 What are the alternatives to Vert.x?</h2>

  <p class="body"><a id="pgfId-1021620"/><a id="marker-1021621"/>As you will see in this book, Vert.x is a compelling technology for building end-to-end reactive applications. Reactive application development is a trendy topic, and it is more important to understand the principles than to blindly become an expert in one specific technology. What you will learn in this book easily transfers to other technologies, and I highly encourage you to check them out.</p>

  <p class="body"><a id="pgfId-1021629"/>Here are the most popular alternatives to Vert.x for asynchronous and reactive programming:</p>

  <ul class="calibre8">
    <li class="fm-list-bullet">
      <p class="list"><a class="calibre9" id="pgfId-1021635"/><i class="fm-italics1">Node.js</i> --Node.js <a class="calibre9" id="marker-1021652"/>is an event-driven runtime for writing asynchronous JavaScript applications. It is based on the V8 JavaScript engine that is used by Google Chrome. At first sight, Vert.x and Node.js have lots of similarities. Still, they differ greatly. Vert.x runs multiple event loops by default, unlike Node.js. Also, the JVM has a better JIT compiler and garbage collector, so the JVM is better suited for long-running processes. Last, but not least, Vert.x supports JavaScript.</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1021696"/><i class="fm-italics1">Akka</i> --Akka <a class="calibre9" id="marker-1060357"/>is a faithful implementation of the <i class="fm-italics1">actor</i> model. It runs on the JVM and primarily offers Scala APIs, although Java bindings are also being promoted. Akka is particularly interesting, as actors are message driven and location transparent, and actors offer supervision features that are interesting for error recovery. Akka clearly targets the design of reactive applications. As you will see in this book, Vert.x is no less capable for the task. Vert.x has a concept of <i class="fm-italics1">verticles</i>, a loose form of actors, that are used for processing asynchronous events. Interestingly, Vert.x is significantly faster than Akka and most alter-natives in established benchmarks, such as TechEmpower benchmarks (<span class="fm-hyperlink1"><a class="calibre9" href="http://www.techempower.com/benchmarks/">www .techempower.com/benchmarks/</a></span>).</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1021729"/><i class="fm-italics1">Spring Framework</i> --The older and widespread Spring Framework <a class="calibre9" id="marker-1060360"/>now integrates a reactive stack. It is based on Project Reactor, an API for reactive programming that is very similar to RxJava. The focus of the Spring reactive stack is essentially on reactive programming APIs, but it does not necessarily lead to end-to-end reactive applications. Many parts of the Spring Framework employ blocking APIs, so extra care must be taken to limit the exposure to blocking operations. Project Reactor is a compelling alternative to RxJava, but the Spring reactive stack is tied to this API, and it may not always be the best way to express certain asynchronous constructions. Vert.x provides more flexibility as it supports callbacks, futures, Java <code class="fm-code-in-text">CompletionStage</code>, Kotlin coroutines<a class="calibre9" id="marker-1060362"/>, RxJava, and fibers. This means that with Vert.x it is easier to select the right asynchronous programming model for a certain task. Also like with Akka, Vert.x remains significantly faster in TechEmpower benchmarks, and applications boot faster than Spring-based ones.</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1021744"/><i class="fm-italics1">Quarkus</i> --Quarkus <a class="calibre9" id="marker-1021757"/>is a new framework for developing Java applications that run exceptionally well in container environments like Kubernetes (<span class="fm-hyperlink1"><a class="calibre9" href="https://quarkus.io">https:// quarkus.io</a></span>). Indeed, in such environments, boot time and memory consumption are critical cost-saving factors. Quarkus employs techniques at compilation time to make sensible gains when running using traditional Java virtual machines and as native executables. It is based on popular libraries like Hibernate, Eclipse MicroProfile, RESTEasy, and Vert.x. Quarkus unifies imperative and reactive programming models, and Vert.x is a cornerstone of the framework. Vert.x is not just used to power some pieces of the networking stack; some client modules are directly based on those from Vert.x, such as the Quarkus mail service and reactive routes. You can also use Vert.x APIs in a Quarkus application, with the unification between reactive and imperative helping you to bridge both worlds. Vert.x and Quarkus have different programming paradigms: Vert.x will appeal to developers who prefer a toolkit approach, or developers who have affinities with Node.js. In contrast, Quarkus will appeal to developers who prefer an opinionated stack approach with dependency injection and convention over configuration. In the end, both projects work together, and anything you develop with Vert.x can be reused in Quarkus.</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1021768"/><i class="fm-italics1">Netty</i> --The Netty <a class="calibre9" id="marker-1021781"/>framework provides non-blocking I/O APIs for the JVM. It provides abstractions and platform-specific bug fixes compared to using raw NIO APIs. It also provides threading models. The target of Netty is low-latency and high-performance network applications. While you can certainly build reactive applications with Netty, the APIs remain somewhat low-level. Vert.x is one of the many technologies built on top of Netty (Spring Reactive and Akka have Netty integration), and you can get all the performance benefits of Netty with the simpler APIs of Vert.x.</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1021791"/><i class="fm-italics1">Scripting languages</i> --Scripting languages such <a class="calibre9" id="marker-1021804"/>as Python and Ruby also provide non-blocking I/O libraries, such as Async (Ruby) and Twisted (Python). You can certainly build reactive systems with them. Again, the JVM performance is an advantage for Vert.x, along with the ability to use alternative JVM languages (Ruby is officially supported by Vert.x).</p>
    </li>

    <li class="fm-list-bullet-last">
      <p class="list"><a class="calibre9" id="pgfId-1021814"/><i class="fm-italics1">Native languages</i> --Native languages are becoming <a class="calibre9" id="marker-1021827"/>trendy again. Instead of using the venerable C/C++ languages, Go, Rust, and Swift are gaining mindshare. They all tick the boxes for building highly scalable applications, and they certainly can be used for creating reactive applications. That being said, most efficient libraries in these languages are fairly low-level, and ultimately the JVM-based Vert.x/Netty combination still ranks favorably in benchmarks.</p>
    </li>
  </ul>

  <p class="body"><a id="pgfId-1021837"/>The following books are good resources for many of the preceding topics:</p>

  <ul class="calibre8">
    <li class="fm-list-bullet">
      <p class="list"><a class="calibre9" id="pgfId-1021843"/><i class="fm-italics1">Node.js in Action</i> by Mike Cantelon, Marc Harter, T.J. Holowaychuk, and Nathan Rajlich (Manning, 2013)</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1021864"/><i class="fm-italics1">Akka in Action</i> by Raymond Roestenburg, Rob Bakker, and Rob Williams (Manning, 2016)</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1021881"/><i class="fm-italics1">Reactive Application Development</i> by Duncan K. DeVore, Sean Walsh, and Brian Hanafee (Manning, 2018)</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1021898"/><i class="fm-italics1">Spring in Action</i>, fifth edition, by Craig Walls (Manning, 2018)</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1021915"/><i class="fm-italics1">Netty in Action</i> by Norman Maurer and Marvin Allen Wolfthal (Manning, 2015)</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1021932"/><i class="fm-italics1">Go in Action</i> by William Kennedy with Brian Ketelsen and Erik St. Martin (Manning, 2015)</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1021949"/><i class="fm-italics1">Rust in Action</i> by Tim McNamara (Manning, 2019)</p>
    </li>

    <li class="fm-list-bullet-last">
      <p class="list"><a class="calibre9" id="pgfId-1021966"/><i class="fm-italics1">Swift in Depth</i> by Tjeerd in 't Veen (Manning, 2018)</p>
    </li>
  </ul>

  <p class="body"><a id="pgfId-1021983"/>In the next chapter, we will dissect the fundamentals of asynchronous programming with Vert.x. <a id="marker-1057705"/></p>

  <h2 class="fm-head" id="heading_id_19"><a id="pgfId-1021992"/>Summary</h2>

  <ul class="calibre8">
    <li class="fm-list-bullet">
      <p class="list"><a class="calibre9" id="pgfId-1022002"/>Asynchronous programming allows you to multiplex multiple networked connections on a single thread.</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1022016"/>Managing non-blocking I/O is more complex than the equivalent imperative code based on blocking I/O, even for simple protocols.</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1022026"/>The event loop and the reactor pattern simplify asynchronous event processing.</p>
    </li>

    <li class="fm-list-bullet1">
      <p class="list"><a class="calibre9" id="pgfId-1022036"/>A reactive system is both scalable and resilient, producing responses with consistent latencies despite demanding workloads and failures.</p>
    </li>

    <li class="fm-list-bullet-last">
      <p class="list"><a class="calibre9" id="pgfId-1022046"/>Vert.x is an approachable, efficient toolkit for writing asynchronous and reactive applications on the JVM.</p>
    </li>
  </ul>
  <hr class="calibre12"/>

  <p class="fm-footnote"><span class="footnotenumber">1.</span><a id="pgfId-1012156"/>For readers already familiar with microservice patterns, “edge service” is, in my opinion, a better term than “API gateway.”</p>
</div></body>
</html>